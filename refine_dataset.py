from xml.dom.minidom import parseString
import xlsxwriter , csv
import sys , string
import re , operator
import glob , os , math

#running syntax
#
#python refine_dataset.py <Raw> <Final>
# chi_score = list()
newdataset = list()
dataset = list()
choosing_array = []
index = []

def choosing_array_generation(fisher_array,number):
	index = [0]*len(fisher_array)
	choose = [0]*len(fisher_array)
	for i in range(len(fisher_array)):
		choose[i] = float(fisher_array[i])
	
	maxi = max(choose)
	#number is the limiting factor which helps us decide on how many features we taking into consideration
	#(maxi,i) = max((v,i) for i,v in enumerate(choose))
	for i in range(len(choose)):
		if(maxi == choose[i]):
			choose[i] = -1
	for i in range(len(choose)):
		if(choose[i] != -1):
			index[i] = 1

	return index


def read_set():

	with open(sys.argv[1] , "r") as file_out:
		reader = csv.reader(file_out)
		dataset = list(reader)
	#print len(dataset[1])

	#removes last element from dataset(padding bit)
	for data in dataset:
		data.pop()
	#print dataset[1]
 	return dataset

#fisher array essentially has the selected features which are to be made into a dataset 
def refine_set(dataset,fisher_array):
	with open(sys.argv[2],"w") as file_in:
 		writer = csv.writer(file_in)
 		for j in range(len(dataset)):
 			data = list()
 			for i in range(len(fisher_array)):
 				if(fisher_array[i] == 1):
 					data.append(str(dataset[j][i]))
 			newdataset.append(data)
 		newdataset.pop()
 		print len(newdataset[0])
 		for data in newdataset:
 			for dat in data:
 				file_in.write(dat)
 				file_in.write(",")
 			"""file_in.writelines(data)"""
 			file_in.write("\n")

# def create_chisqared_score(dataset):
# 	with open("chi_score.txt", "w") as file_in:
# 		writer = csv.writer(file_in)
# 		for j in range(1, len(dataset) - 1):
# 			data = list()
# 			for i in range(len(data) - 1):
				



dataset = read_set()
#print dataset[len(dataset) - 1]
index = choosing_array_generation(dataset[len(dataset) - 1] , 1000)
refine_set(dataset,index)

"""print index
c = 0 
for i in range(len(index)):
	if(index[i] == 1):
		c +=1

print c"""